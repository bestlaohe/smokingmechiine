# 智能焊接抽烟机电路连接定义

## 1. 系统电路框图

```
┌──────────────┐      ┌───────────────┐      ┌────────────────┐
│              │      │               │      │                │
│  电源管理模块 ├──────┤  主控制器     ├──────┤  显示控制模块  │
│  (TP4057)    │      │ (CH32V003)    │      │  (GC9107)      │
│              │      │               │      │                │
└──────┬───────┘      └───┬───┬───┬───┘      └────────────────┘
       │                  │   │   │
       │                  │   │   │
┌──────┴───────┐     ┌────┴───┴───┴────┐     ┌────────────────┐
│              │     │                  │     │                │
│  锂电池模块   │     │  风扇控制电路    │     │  LED照明模块   │
│ (2×21700)    │     │  (MOSFET驱动)    │     │                │
│              │     │                  │     │                │
└──────────────┘     └──────────────────┘     └────────────────┘
```

## 2. 模块间连接关系

### 2.1 主控制器与显示模块连接

| CH32V003引脚 | GC9107引脚 | 信号类型 | 说明                 |
|--------------|------------|----------|--------------------|
| PC0          | CS         | 数字输出 | SPI片选信号         |
| PC1          | SCL        | 数字输出 | SPI时钟信号         |
| PC2          | SDA        | 数字输出 | SPI数据信号         |
| PC3          | DC         | 数字输出 | 数据/命令选择       |
| PC4          | RES        | 数字输出 | 复位信号            |
| 3.3V         | VCC        | 电源     | 显示模块供电        |
| GND          | GND        | 电源     | 系统地              |
| 3.3V         | BLK        | 电源     | 背光供电(常亮)      |

### 2.2 主控制器与风扇控制电路连接

| CH32V003引脚 | 连接至           | 信号类型 | 说明                 |
|--------------|------------------|----------|--------------------|
| PD4          | MOSFET栅极       | PWM输出  | 控制风扇转速        |
| PD5          | PM2.5传感器输出  | 模拟输入 | 检测烟雾浓度        |
| GND          | MOSFET源极       | 电源     | 系统地              |
| VCC          | MOSFET漏极       | 电源     | 通过风扇回到电源    |

### 2.3 主控制器与LED照明模块连接

| CH32V003引脚 | 连接至           | 信号类型 | 说明                |
|--------------|------------------|----------|-------------------|
| PA2          | LED驱动电路      | PWM输出  | 控制LED亮度        |
| GND          | LED负极          | 电源     | 系统地             |

### 2.4 主控制器与人机交互控件连接

| CH32V003引脚 | 连接至           | 信号类型 | 说明                |
|--------------|------------------|----------|-------------------|
| PD6          | 编码器A相        | 数字输入 | 检测编码器旋转      |
| PD7          | 编码器B相        | 数字输入 | 检测旋转方向        |
| PA1          | 功能按键         | 数字输入 | 用户按键输入        |
| PC7          | 状态指示LED      | 数字输出 | 系统状态指示        |

### 2.5 主控制器与电源管理模块连接

| CH32V003引脚 | 连接至           | 信号类型 | 说明                |
|--------------|------------------|----------|-------------------|
| PC5          | 电压分压器输出   | 模拟输入 | 检测电池电压        |
| PC6          | 充电IC状态引脚   | 数字输入 | 检测充电状态        |

## 3. 电源管理设计

### 3.1 充电电路设计

基于TP4057锂电池充电管理芯片，主要参数如下：
- 充电电流：1A (通过RPROG电阻设置)
- 充电截止电压：4.2V
- 涓流充电阈值：2.9V
- 充电截止电流：100mA

```
                      VCC
                       │
                       ▼
           ┌───────────┴────────┐
           │                    │
USB 5V ────┤ VIN       VBAT     ├──── 电池正极
           │                    │
           │      TP4057        │
           │                    │
GND ───────┤ GND       STAT     ├──── PC6 (充电状态)
           │                    │
           │           PROG     ├──── RPROG (1.2K)
           │                    │
           └────────────────────┘
```

### 3.2 电源分配

| 模块名称         | 供电电压  | 最大电流 | 来源           |
|------------------|-----------|----------|----------------|
| CH32V003控制器   | 3.3V      | 50mA    | LDO稳压器      |
| GC9107显示模块   | 3.3V      | 20mA    | LDO稳压器      |
| LED照明模块      | 3.7V      | 800mA   | 电池直接供电   |
| 风扇驱动电路     | 12V       | 200mA   | DC-DC升压模块  |
| PM2.5传感器      | 5V        | 100mA   | DC-DC升压模块  |

### 3.3 电池保护电路

采用专用锂电池保护IC，提供以下保护功能：
- 过充保护电压：4.25V
- 过放保护电压：2.9V
- 过流保护阈值：3A
- 短路保护

## 4. 关键元器件清单

| 元件类别 | 型号            | 数量 | 关键参数                 |
|----------|-----------------|------|--------------------------|
| 主控制器 | CH32V003F4P6    | 1    | RISC-V，TSSOP20封装     |
| 显示驱动 | GC9107          | 1    | 分辨率：128×160，SPI接口|
| 电源管理 | TP4057          | 1    | 单节锂电池充电IC        |
| 锂电池   | 21700型号       | 2    | 3.7V, 5000mAh           |
| DC-DC转换| ETA3425         | 1    | 输入3.7V，输出12V/5V    |
| LED驱动  | AP5725          | 1    | PWM调光驱动，恒流输出   |
| 风扇驱动 | IRLML2502       | 1    | N沟道MOSFET，3.5A，20V  |
| 编码器   | EC11            | 1    | 带按键旋转编码器        |
| 风扇     | 6025双滚珠风扇  | 1    | 12V, 0.2A, <45dB        |
| PM2.5传感器| GP2Y1010AU0F | 1    | 夏普光学式灰尘传感器    |

## 5. PCB布局注意事项

1. **电源部分**
   - 充电IC周围布局需考虑散热
   - 电源走线宽度不小于1.5mm
   - 在电池接口附近设置保险丝

2. **信号部分**
   - SPI信号线尽量短而粗
   - 模拟信号和数字信号分区布局
   - PM2.5传感器信号线做好屏蔽和滤波

3. **布局分区**
   - 高压/高流部分与信号处理电路隔离
   - 注意风扇PWM驱动和LED驱动的散热设计
   - 显示模块单独一个区域，尽量减少干扰

## 6. 电源预算

### 6.1 不同工作模式下的功耗

| 工作模式     | 风扇功率 | LED功率 | 控制电路功率 | 总功耗 | 电池续航 |
|--------------|----------|---------|--------------|--------|----------|
| 满功率模式   | 2.4W     | 3.0W    | 0.2W         | 5.6W   | ≥2h      |
| 节能模式     | 0.6W     | 0.5W    | 0.2W         | 1.3W   | ≥8h      |
| 仅抽烟模式   | 2.4W     | 0W      | 0.2W         | 2.6W   | ≥4h      |
| 仅照明模式   | 0W       | 3.0W    | 0.2W         | 3.2W   | ≥3.5h    |
| 待机模式     | 0W       | 0W      | 0.05W        | 0.05W  | ≥200h    |

### 6.2 充电时间估算

- 电池容量：2 × 5000mAh (并联) = 10000mAh
- 充电电流：1A
- 理论充电时间：约10小时
- 实际充电时间（考虑效率）：约12小时

## 7. 接口定义

### 7.1 外部接口

| 接口名称     | 接口类型      | 位置       | 说明               |
|--------------|---------------|------------|-------------------|
| 充电接口     | Type-C        | 底部       | 5V/2A输入         |
| 风扇出风口   | 圆形网罩      | 顶部       | 导出焊接烟雾      |
| 磁吸底座接口 | 磁性接触面    | 背部       | 用于固定设备位置  |
| 电源开关     | 滑动开关      | 侧面       | 总电源开关        |

### 7.2 内部测试点

| 测试点名称   | 连接至        | 电压范围   | 说明              |
|--------------|---------------|------------|------------------|
| TP1          | 电池电压      | 3.0V-4.2V  | 监测电池电压     |
| TP2          | 系统3.3V      | 3.3V±5%    | 检查稳压器输出   |
| TP3          | 风扇12V       | 12V±5%     | 检查升压电路输出 |
| TP4          | MCU复位线     | 0V/3.3V    | 手动复位系统     |
| TP5          | GND           | 0V         | 系统地           |

## 8. 机械结构与电路配合注意事项

1. 电池仓设计需考虑散热和防震
2. 显示屏位置需确保用户操作便利性
3. 旋钮和按键位置要便于单手操作
4. 风扇进风口避免灰尘直接进入电路板区域
5. LED照明模块散热设计要充分
6. 预留足够的维修和更换空间

## 9. 版本历史

| 版本号 | 日期       | 主要变更                       |
|--------|------------|-----------------------------|
| V0.1   | 2023-09-01 | 初版电路定义                 |
| V0.2   | 2023-09-15 | 增加PM2.5传感器电路设计      |
| V0.3   | 2023-09-25 | 完善电源部分设计和保护电路   | 